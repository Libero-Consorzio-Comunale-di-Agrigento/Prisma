--liquibase formatted sql
--changeset esasdelli:AGSPR_VIEW_AGP_PROTO_VIEW runOnChange:true stripComments:false

CREATE OR REPLACE FORCE VIEW AGP_PROTO_VIEW
(
   ID_DOCUMENTO,
   ACCETTAZIONE_ANNULLAMENTO,
   ALLEGATO_PRINCIPALE,
   ANNO,
   ANNO_EMERGENZA,
   ANNO_PROT_PREC_SUCC,
   ANNULLATO,
   APPLICATIVO_ESTERNO,
   BLOCCO_MODIFICHE,
   CARICO_INOLTRO,
   C_FISCALE_IMPRESA,
   CHECK_FUNZIONARIO,
   CLASS_COD,
   CLASS_DAL,
   CODICE_AMMINISTRAZIONE,
   CODICE_AOO,
   CODICE_FISCALE,
   COGNOME,
   COMP_TITO,
   CONTROLLA_ESTREMI_PROTOCOLLO,
   CREA_LINK,
   DA_FASCICOLARE,
   DAL,
   DAL_PERSONA,
   DATA,
   DATA_ACCETTAZIONE_ANN,
   DATA_ANN,
   DATA_ARCHIVIAZIONE,
   DATA_ARRIVO,
   DATA_BLOCCO_MODIFICHE,
   DATA_CREAZIONE,
   DATA_DOCUMENTO,
   DATA_EMERGENZA,
   DATA_EVASIONE,
   DATA_FINE,
   DATA_FINE_EMERGENZA,
   DATA_INIZIO,
   DATA_INIZIO_EMERGENZA,
   DATA_MODIFICA,
   DATA_NULLA_OSTA,
   DATA_RICHIESTA_ANN,
   DATA_SCADENZA,
   DATA_SPEDIZIONE,
   DATA_STATO,
   DATA_STATO_SCARTO,
   DATA_VERIFICA,
   DATI_RIPUDIO,
   DESCRIZIONE_CLASSIFICA,
   DESCRIZIONE_CLASSIFICA_VISU,
   DESCRIZIONE_FASCICOLO,
   DESCRIZIONE_FASCICOLO_VISU,
   DESCRIZIONE_MODELLO_TESTI,
   DESCRIZIONE_RADICE_SUDD,
   DESCRIZIONE_TIPO_DOCUMENTO,
   DESCRIZIONE_TIPO_REGISTRO,
   DESCRIZIONE_UNITA,
   DESCR_UNITA_RICHIESTA_ANN,
   DES_SCARTO_FASC,
   DIRIGENTE,
   DIRIGENTE_NOME_COGNOME,
   DOCUMENTO_TRAMITE,
   EVASO,
   FASCICOLO_ANNO,
   FASCICOLO_NUMERO,
   FIRMA,
   FIRMATARIO,
   FIRMATO,
   FUNZIONARIO,
   ID_DOC_ESTERNO,
   ID_DOCUMENTO_PROTOCOLLO,
   IDRIF,
   INCLUDEAPPLET,
   INTERVENTO_OPERATORE,
   INTESTAZIONE_PDF_1,
   INTESTAZIONE_PDF_2,
   INVIATA_CONF_RIC,
   INVIATO_AGGIORNAMENTO,
   INVIATO_ANNULLAMENTO,
   KEY_ITER_ACQUISIZIONE,
   KEY_ITER_LETTERA,
   KEY_ITER_PROTOCOLLO,
   KEY_ITER_PROVVEDIMENTO,
   LOG_DATA_AL,
   LOG_DATA_DAL,
   LOG_LABEL_CAMPO,
   LOG_NOME_CAMPO,
   MASTER,
   MITTENTE,
   MODALITA,
   MODALITA_ARCHIVIAZIONE,
   MODELLO_TESTI,
   MODIFICA_FIRMA,
   MOTIVO_ANN,
   MOTIVO_EMERGENZA,
   MOTIVO_RICH_INTERVENTO,
   NI,
   NI_PERSONA,
   NOME,
   NOMINATIVO_UTENTE_RICH_ANN,
   NOTE,
   NUMERO,
   NUMERO_DOCUMENTO,
   NUMERO_EMERGENZA,
   NUMERO_FINE,
   NUMERO_INIZIO,
   NUMERO_NULLA_OSTA,
   NUMERO_TOTALE,
   OGGETTO,
   OGGI,
   PAR_PASSAGGIO,
   PARTITA_IVA_IMPRESA,
   POSIZIONE_FLUSSO,
   PRAT_ANNO,
   PRAT_NUMERO,
   PRIMA_REG_COD_AMM,
   PRIMA_REG_COD_AOO,
   PRIMA_REG_DATA,
   PRIMA_REG_NUMERO,
   PROT_PREC_SUCC,
   PROVVEDIMENTO_ANN,
   PROVV_EMERGENZA,
   QUOVADIS,
   RACCOMANDATA_NUMERO,
   REG_ACCETTAZIONE_AGGIORNAMENTO,
   REG_ACCETTAZIONE_ANNULLAMENTO,
   REG_ACCETTAZIONE_CONFERMA,
   REGISTRATA_ACCETTAZIONE,
   REGISTRATA_NON_ACCETTAZIONE,
   REGISTRO_EMERGENZA,
   REG_NON_ACCETTAZIONE_AGG,
   REG_NON_ACCETTAZIONE_ANN,
   REG_NON_ACCETTAZIONE_CONFERMA,
   RICERCA_CON_RPI,
   RICERCA_FINE,
   RICERCA_INIZIO,
   RICEVUTA_ANOMALIA,
   RICEVUTA_ANOMALIA_AGG,
   RICEVUTA_ANOMALIA_ANN,
   RICEVUTA_ANOMALIA_CONFERMA,
   RICEVUTA_CARICO,
   RICEVUTA_CARICO_AGG,
   RICEVUTA_CARICO_ANN,
   RICEVUTA_CARICO_CONFERMA,
   RICEVUTA_ERRORE,
   RICEVUTA_ERRORE_AGG,
   RICEVUTA_ERRORE_ANN,
   RICEVUTA_ERRORE_CONFERMA,
   RICH_CONF_RIC,
   RICHIESTA_REVISIONE_DIRIGENTE,
   RIGENERATO_PDF,
   RISERVATO,
   RTF,
   RTF_PDF,
   SO4_DIRIGENTE,
   SO4_FUNZIONARIO,
   SPEDITO,
   STAMPA_SUBITO,
   STATO_FIRMA,
   STATO_LETTERA,
   STATO_PR,
   STATO_SCARTO,
   SUAP_FILE,
   SUAP_IDDOC_FILE,
   SUAP_PRATICA,
   SUB,
   TAG_MAIL,
   TEMP_PATH,
   TIPO_CATALOGO,
   TIPO_DOCUMENTO,
   TIPO_LETTERA,
   TIPO_MESSAGGIO,
   TIPO_REGISTRO,
   TIPO_REGISTRO_TEMP,
   TIPO_STATO,
   TITOLO,
   TITOLO_DOCUMENTO,
   TOTALE_ALLEGATI,
   TOTALE_ANNULLATI,
   UBICAZIONE_FASCICOLO,
   UNITA_ESIBENTE,
   UNITA_PROTOCOLLANTE,
   UNITA_RICHIESTA_ANN,
   UNITA_RIS,
   UTENTE_ANN,
   UTENTE_BLOCCO_MODIFICHE,
   UTENTE_FIRMA,
   UTENTE_PROTOCOLLANTE,
   UTENTE_RICHIESTA_ANN,
   UTENTE_SESSIONE,
   UTENTI_FIRMA,
   VALIDITA,
   VERIFICA_FIRMA,
   VISUALIZZA_TIMBRO,
   FULL_TEXT,
   ID_ENTE,
   LINK_DOCUMENTO,
   CATEGORIA,
   AREA,
   CODICE_MODELLO,
   CODICE_RICHIESTA,
   UTENTE_AGGIORNAMENTO
)
AS
   SELECT p."ID_DOCUMENTO",
          p."ACCETTAZIONE_ANNULLAMENTO",
          p."ALLEGATO_PRINCIPALE",
          p."ANNO",
          p."ANNO_EMERGENZA",
          p."ANNO_PROT_PREC_SUCC",
          CAST (nvl(p."ANNULLATO", 'N') AS CHAR (1)),
          p."APPLICATIVO_ESTERNO",
          p."BLOCCO_MODIFICHE",
          p."CARICO_INOLTRO",
          p."C_FISCALE_IMPRESA",
          p."CHECK_FUNZIONARIO",
          p."CLASS_COD",
          p."CLASS_DAL",
          p."CODICE_AMMINISTRAZIONE",
          p."CODICE_AOO",
          p."CODICE_FISCALE",
          p."COGNOME",
          p."COMP_TITO",
          p."CONTROLLA_ESTREMI_PROTOCOLLO",
          p."CREA_LINK",
          p."DA_FASCICOLARE",
          p."DAL",
          p."DAL_PERSONA",
          p."DATA",
          p."DATA_ACCETTAZIONE_ANN",
          p."DATA_ANN",
          p."DATA_ARCHIVIAZIONE",
          p."DATA_ARRIVO",
          p."DATA_BLOCCO_MODIFICHE",
          p."DATA_CREAZIONE",
          p."DATA_DOCUMENTO",
          p."DATA_EMERGENZA",
          p."DATA_EVASIONE",
          p."DATA_FINE",
          p."DATA_FINE_EMERGENZA",
          p."DATA_INIZIO",
          p."DATA_INIZIO_EMERGENZA",
          p."DATA_MODIFICA",
          p."DATA_NULLA_OSTA",
          p."DATA_RICHIESTA_ANN",
          p."DATA_SCADENZA",
          p."DATA_SPEDIZIONE",
          p."DATA_STATO",
          p."DATA_STATO_SCARTO",
          p."DATA_VERIFICA",
          p."DATI_RIPUDIO",
          p."DESCRIZIONE_CLASSIFICA",
          p."DESCRIZIONE_CLASSIFICA_VISU",
          p."DESCRIZIONE_FASCICOLO",
          p."DESCRIZIONE_FASCICOLO_VISU",
          p."DESCRIZIONE_MODELLO_TESTI",
          p."DESCRIZIONE_RADICE_SUDD",
          p."DESCRIZIONE_TIPO_DOCUMENTO",
          p."DESCRIZIONE_TIPO_REGISTRO",
          p."DESCRIZIONE_UNITA",
          p."DESCR_UNITA_RICHIESTA_ANN",
          p."DES_SCARTO_FASC",
          p."DIRIGENTE",
          p."DIRIGENTE_NOME_COGNOME",
          p."DOCUMENTO_TRAMITE",
          p."EVASO",
          p."FASCICOLO_ANNO",
          p."FASCICOLO_NUMERO",
          p."FIRMA",
          p."FIRMATARIO",
          p."FIRMATO",
          p."FUNZIONARIO",
          p."ID_DOC_ESTERNO",
          p."ID_DOCUMENTO_PROTOCOLLO",
          p."IDRIF",
          p."INCLUDEAPPLET",
          p."INTERVENTO_OPERATORE",
          p."INTESTAZIONE_PDF_1",
          p."INTESTAZIONE_PDF_2",
          p."INVIATA_CONF_RIC",
          p."INVIATO_AGGIORNAMENTO",
          p."INVIATO_ANNULLAMENTO",
          p."KEY_ITER_ACQUISIZIONE",
          p."KEY_ITER_LETTERA",
          p."KEY_ITER_PROTOCOLLO",
          p."KEY_ITER_PROVVEDIMENTO",
          p."LOG_DATA_AL",
          p."LOG_DATA_DAL",
          p."LOG_LABEL_CAMPO",
          p."LOG_NOME_CAMPO",
          p."MASTER",
          DECODE (p.modalita,
                  'ARR', gdm_get_rapporti_doc (p.idrif, 'MITT'),
                  '')
             MITTENTE,
          p."MODALITA",
          p."MODALITA_ARCHIVIAZIONE",
          p."MODELLO_TESTI",
          p."MODIFICA_FIRMA",
          p."MOTIVO_ANN",
          p."MOTIVO_EMERGENZA",
          p."MOTIVO_RICH_INTERVENTO",
          p."NI",
          p."NI_PERSONA",
          p."NOME",
          p."NOMINATIVO_UTENTE_RICH_ANN",
          p."NOTE",
          p."NUMERO",
          p."NUMERO_DOCUMENTO",
          p."NUMERO_EMERGENZA",
          p."NUMERO_FINE",
          p."NUMERO_INIZIO",
          p."NUMERO_NULLA_OSTA",
          p."NUMERO_TOTALE",
          p."OGGETTO",
          p."OGGI",
          p."PAR_PASSAGGIO",
          p."PARTITA_IVA_IMPRESA",
          p."POSIZIONE_FLUSSO",
          p."PRAT_ANNO",
          p."PRAT_NUMERO",
          p."PRIMA_REG_COD_AMM",
          p."PRIMA_REG_COD_AOO",
          p."PRIMA_REG_DATA",
          p."PRIMA_REG_NUMERO",
          p."PROT_PREC_SUCC",
          p."PROVVEDIMENTO_ANN",
          p."PROVV_EMERGENZA",
          p."QUOVADIS",
          p."RACCOMANDATA_NUMERO",
          p."REG_ACCETTAZIONE_AGGIORNAMENTO",
          p."REG_ACCETTAZIONE_ANNULLAMENTO",
          p."REG_ACCETTAZIONE_CONFERMA",
          p."REGISTRATA_ACCETTAZIONE",
          p."REGISTRATA_NON_ACCETTAZIONE",
          p."REGISTRO_EMERGENZA",
          p."REG_NON_ACCETTAZIONE_AGG",
          p."REG_NON_ACCETTAZIONE_ANN",
          p."REG_NON_ACCETTAZIONE_CONFERMA",
          p."RICERCA_CON_RPI",
          p."RICERCA_FINE",
          p."RICERCA_INIZIO",
          p."RICEVUTA_ANOMALIA",
          p."RICEVUTA_ANOMALIA_AGG",
          p."RICEVUTA_ANOMALIA_ANN",
          p."RICEVUTA_ANOMALIA_CONFERMA",
          p."RICEVUTA_CARICO",
          p."RICEVUTA_CARICO_AGG",
          p."RICEVUTA_CARICO_ANN",
          p."RICEVUTA_CARICO_CONFERMA",
          p."RICEVUTA_ERRORE",
          p."RICEVUTA_ERRORE_AGG",
          p."RICEVUTA_ERRORE_ANN",
          p."RICEVUTA_ERRORE_CONFERMA",
          p."RICH_CONF_RIC",
          p."RICHIESTA_REVISIONE_DIRIGENTE",
          p."RIGENERATO_PDF",
          CAST (nvl(p."RISERVATO", 'N') AS CHAR (1)),
          p."RTF",
          p."RTF_PDF",
          p."SO4_DIRIGENTE",
          p."SO4_FUNZIONARIO",
          p."SPEDITO",
          p."STAMPA_SUBITO",
          p."STATO_FIRMA",
          p."STATO_LETTERA",
          p."STATO_PR",
          p."STATO_SCARTO",
          p."SUAP_FILE",
          p."SUAP_IDDOC_FILE",
          p."SUAP_PRATICA",
          p."SUB",
          p."TAG_MAIL",
          p."TEMP_PATH",
          p."TIPO_CATALOGO",
          p."TIPO_DOCUMENTO",
          p."TIPO_LETTERA",
          p."TIPO_MESSAGGIO",
          p."TIPO_REGISTRO",
          p."TIPO_REGISTRO_TEMP",
          p."TIPO_STATO",
          p."TITOLO",
          p."TITOLO_DOCUMENTO",
          p."TOTALE_ALLEGATI",
          p."TOTALE_ANNULLATI",
          p."UBICAZIONE_FASCICOLO",
          p."UNITA_ESIBENTE",
          p."UNITA_PROTOCOLLANTE",
          p."UNITA_RICHIESTA_ANN",
          p."UNITA_RIS",
          p."UTENTE_ANN",
          p."UTENTE_BLOCCO_MODIFICHE",
          p."UTENTE_FIRMA",
          p."UTENTE_PROTOCOLLANTE",
          p."UTENTE_RICHIESTA_ANN",
          p."UTENTE_SESSIONE",
          p."UTENTI_FIRMA",
          p."VALIDITA",
          p."VERIFICA_FIRMA",
          p."VISUALIZZA_TIMBRO",
          p."FULL_TEXT",
          agp_utility_pkg.get_id_ente (p.codice_amministrazione,
                                       p.codice_aoo)
             id_ente,
          gdc_utility_pkg.f_get_url_oggetto ('',
                                             '',
                                             p.id_documento,
                                             'D',
                                             '',
                                             '',
                                             '',
                                             'R',
                                             '',
                                             '',
                                             '5',
                                             'N')
             link_documento,
          DECODE (NVL (td.nome, 'M_PROTOCOLLO'),
                  'M_REGISTRO_GIORNALIERO', 'REGISTRO_GIORNALIERO',
                  'M_PROTOCOLLO_INTEROPERABILITA', 'PEC',
                  'M_PROTOCOLLO_EMERGENZA', 'EMERGENZA',
                  'LETTERA_USCITA', 'LETTERA',
                  'M_PROVVEDIMENTO', 'PROVVEDIMENTO',
                  'PROTOCOLLO')
             categoria,
          td.area_modello,
          NVL (td.nome, 'M_PROTOCOLLO'),
          d.CODICE_RICHIESTA,
          D.UTENTE_AGGIORNAMENTO
     FROM gdm_proto_view p, gdm_documenti d, gdm_tipi_documento td
    WHERE     d.id_documento = p.id_documento
          AND d.stato_documento NOT IN ('CA', 'RE', 'PB')
          AND td.id_tipodoc(+) = d.id_tipodoc
/
